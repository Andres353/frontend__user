#  API Completa - Santiago Users MS

##  Informaci贸n General

**Microservicio:** Santiago Users MS  
**Versi贸n:** 1.0.0  
**URL Base:** `http://localhost:3002/santiago-users`  
**Swagger UI:** `http://localhost:3002/swagger-ui.html`  
**Puerto:** 3002  
**Base de Datos:** MongoDB  

---

##  ndice de Endpoints

###  **Gesti贸n de Usuarios Online**
- [POST /add-user](#1-post-add-user) - Crear nuevo usuario
- [PUT /edit-user](#2-put-edit-user) - Editar usuario
- [POST /login](#3-post-login) - Login de usuario
- [PUT /logout/{id}](#4-put-logoutid) - Logout de usuario
- [GET /user-data](#5-get-user-data) - Obtener datos de usuario
- [PUT /user-status/{id}](#6-put-user-statusid) - Cambiar estatus de usuario
- [DELETE /delete-user/{id}](#7-delete-delete-userid) - Eliminar usuario
- [GET /get-all-users](#8-get-get-all-users) - Listar usuarios (paginado)

###  **Gesti贸n de Usuarios Offline**
- [POST /user-offline-new](#9-post-user-offline-new) - Crear usuario offline
- [PUT /user-offline-update](#10-put-user-offline-update) - Actualizar usuario offline
- [GET /user-get-name](#11-get-user-get-name) - Buscar usuario por nombre
- [GET /user-get-nit](#12-get-user-get-nit) - Buscar usuario por NIT
- [GET /user-get-number](#13-get-user-get-number) - Buscar usuario por n煤mero
- [GET /user-get-cellphone](#14-get-user-get-cellphone) - Buscar usuario por celular
- [GET /get-all-users-offline](#15-get-get-all-users-offline) - Listar usuarios offline (paginado)

###  **Gesti贸n de Direcciones**
- [POST /add-new-direction](#16-post-add-new-direction) - Crear direcci贸n
- [PUT /edit-direction](#17-put-edit-direction) - Editar direcci贸n
- [DELETE /delete-direction](#18-delete-delete-direction) - Eliminar direcci贸n
- [GET /user-directions](#19-get-user-directions) - Obtener direcciones de usuario

### Ь **Gesti贸n de Facturaci贸n**
- [POST /add-factura](#20-post-add-factura) - Crear facturaci贸n
- [PUT /edit-factura](#21-put-edit-factura) - Editar facturaci贸n
- [DELETE /delete-factura](#22-delete-delete-factura) - Eliminar facturaci贸n
- [GET /facturaciones-user](#23-get-facturaciones-user) - Obtener facturaciones de usuario

###  **Autenticaci贸n Social**
- [POST /google-login](#24-post-google-login) - Login con Google
- [POST /google-operation](#25-post-google-operation) - Operaci贸n con Google
- [POST /facebook-login](#26-post-facebook-login) - Login con Facebook
- [POST /facebook-operation](#27-post-facebook-operation) - Operaci贸n con Facebook

### 锔 **Funcionalidades Adicionales**
- [POST /add-expo-token](#28-post-add-expo-token) - Agregar token Expo
- [POST /img](#29-post-img) - Subir imagen
- [PUT /user-last-location](#30-put-user-last-location) - Actualizar 煤ltima ubicaci贸n

---

##  Gesti贸n de Usuarios Online

### 1. POST /add-user

**Descripci贸n:** Crea un nuevo usuario en el sistema.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "names": "string",
  "lastNames": "string",
  "phoneNumber": "string",
  "email": "string",
  "password": "string"
}
```

**Par谩metros:**
- `names` (string, requerido): Nombres del usuario
- `lastNames` (string, requerido): Apellidos del usuario
- `phoneNumber` (string, requerido): N煤mero de tel茅fono
- `email` (string, requerido): Email del usuario
- `password` (string, requerido): Contrase帽a del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario creado exitosamente"
}
```

**Respuestas de Error:**
```json
{
  "codeError": "COD353",
  "msgError": "Cuenta existente"
}
```

---

### 2. PUT /edit-user

**Descripci贸n:** Actualiza los datos de un usuario existente.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "id": "string",
  "names": "string",
  "lastNames": "string",
  "phoneNumber": "string",
  "email": "string"
}
```

**Par谩metros:**
- `id` (string, requerido): ID del usuario a editar
- `names` (string, opcional): Nuevos nombres
- `lastNames` (string, opcional): Nuevos apellidos
- `phoneNumber` (string, opcional): Nuevo n煤mero de tel茅fono
- `email` (string, opcional): Nuevo email

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario actualizado exitosamente"
}
```

---

### 3. POST /login

**Descripci贸n:** Autentica un usuario en el sistema.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "id": "string",
  "password": "string"
}
```

**Par谩metros:**
- `id` (string, requerido): Email o ID del usuario
- `password` (string, requerido): Contrase帽a del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Login exitoso"
}
```

**Respuesta de Error:**
```json
{
  "codeError": "COD500",
  "msgError": "Credenciales no v谩lidas"
}
```

---

### 4. PUT /logout/{id}

**Descripci贸n:** Cierra la sesi贸n de un usuario.

**Par谩metros de Path:**
- `id` (string): ID del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Logout exitoso"
}
```

---

### 5. GET /user-data

**Descripci贸n:** Obtiene los datos completos de un usuario.

**Par谩metros de Query:**
- `userid` (string): ID del usuario

**Respuesta Exitosa:**
```json
{
  "names": "string",
  "lastNames": "string",
  "phoneNumber": "string",
  "email": "string",
  "id": "string",
  "lastLocation": "object",
  "status": "boolean",
  "img": "string",
  "generic": {
    "codeError": "COD200",
    "msgError": "Datos obtenidos exitosamente"
  }
}
```

---

### 6. PUT /user-status/{id}

**Descripci贸n:** Cambia el estatus de un usuario (activo/inactivo).

**Par谩metros de Path:**
- `id` (string): ID del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Estatus actualizado"
}
```

---

### 7. DELETE /delete-user/{id}

**Descripci贸n:** Elimina un usuario del sistema.

**Par谩metros de Path:**
- `id` (string): ID del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario eliminado"
}
```

---

### 8. GET /get-all-users

**Descripci贸n:** Obtiene una lista paginada de todos los usuarios.

**Par谩metros de Query:**
- `size` (int): Tama帽o de la p谩gina
- `pageNo` (int): N煤mero de p谩gina

**Respuesta Exitosa:**
```json
{
  "users": [
    {
      "id": "string",
      "names": "string",
      "lastNames": "string",
      "phoneNumber": "string",
      "email": "string",
      "status": "boolean"
    }
  ],
  "generic": {
    "codeError": "COD200",
    "msgError": "Datos encontrados"
  }
}
```

---

##  Gesti贸n de Usuarios Offline

### 9. POST /user-offline-new

**Descripci贸n:** Crea un nuevo usuario offline.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "nombre": "string",
  "contacto": "string",
  "celular": "string",
  "nit": "string",
  "ubicacion": "string",
  "url": "string",
  "alias": "string",
  "detallesPedido": "string",
  "metodoPago": "string"
}
```

**Par谩metros:**
- `nombre` (string, requerido): Nombre del usuario
- `contacto` (string, requerido): Informaci贸n de contacto
- `celular` (string, requerido): N煤mero de celular
- `nit` (string, requerido): NIT del usuario
- `ubicacion` (string, requerido): Ubicaci贸n del usuario
- `url` (string, opcional): URL de ubicaci贸n
- `alias` (string, opcional): Alias de la ubicaci贸n
- `detallesPedido` (string, opcional): Detalles del pedido
- `metodoPago` (string, opcional): M茅todo de pago preferido

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario offline creado exitosamente"
}
```

---

### 10. PUT /user-offline-update

**Descripci贸n:** Actualiza los datos de un usuario offline.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "id": "string",
  "nombre": "string",
  "contacto": "string",
  "celular": "string",
  "nit": "string",
  "ubicacion": "string",
  "url": "string",
  "alias": "string",
  "detallesPedido": "string",
  "metodoPago": "string"
}
```

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario offline actualizado exitosamente"
}
```

---

### 11. GET /user-get-name

**Descripci贸n:** Busca un usuario offline por nombre.

**Par谩metros de Query:**
- `name` (string): Nombre del usuario

**Respuesta Exitosa:**
```json
{
  "userData": {
    "id": "string",
    "nombre": "string",
    "contacto": "string",
    "celular": "string",
    "nit": "string",
    "ubicacion": "string"
  },
  "generic": {
    "codeError": "COD200",
    "msgError": "Usuario encontrado"
  }
}
```

---

### 12. GET /user-get-nit

**Descripci贸n:** Busca un usuario offline por NIT.

**Par谩metros de Query:**
- `nit` (string): NIT del usuario

**Respuesta Exitosa:**
```json
{
  "userData": {
    "id": "string",
    "nombre": "string",
    "contacto": "string",
    "celular": "string",
    "nit": "string",
    "ubicacion": "string"
  },
  "generic": {
    "codeError": "COD200",
    "msgError": "Usuario encontrado"
  }
}
```

---

### 13. GET /user-get-number

**Descripci贸n:** Busca un usuario offline por n煤mero.

**Par谩metros de Query:**
- `number` (string): N煤mero del usuario

**Respuesta Exitosa:**
```json
{
  "userData": {
    "id": "string",
    "nombre": "string",
    "contacto": "string",
    "celular": "string",
    "nit": "string",
    "ubicacion": "string"
  },
  "generic": {
    "codeError": "COD200",
    "msgError": "Usuario encontrado"
  }
}
```

---

### 14. GET /user-get-cellphone

**Descripci贸n:** Busca un usuario offline por celular.

**Par谩metros de Query:**
- `cellphone` (string): Celular del usuario

**Respuesta Exitosa:**
```json
{
  "userData": {
    "id": "string",
    "nombre": "string",
    "contacto": "string",
    "celular": "string",
    "nit": "string",
    "ubicacion": "string"
  },
  "generic": {
    "codeError": "COD200",
    "msgError": "Usuario encontrado"
  }
}
```

---

### 15. GET /get-all-users-offline

**Descripci贸n:** Obtiene una lista paginada de usuarios offline.

**Par谩metros de Query:**
- `size` (int): Tama帽o de la p谩gina
- `pageNo` (int): N煤mero de p谩gina

**Respuesta Exitosa:**
```json
{
  "users": [
    {
      "id": "string",
      "nombre": "string",
      "contacto": "string",
      "celular": "string",
      "nit": "string",
      "ubicacion": "string"
    }
  ],
  "generic": {
    "codeError": "COD200",
    "msgError": "Datos encontrados"
  }
}
```

---

##  Gesti贸n de Direcciones

### 16. POST /add-new-direction

**Descripci贸n:** Crea una nueva direcci贸n para un usuario.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "location": "string",
  "lat": "number",
  "lng": "number",
  "alias": "string",
  "url": "string",
  "userId": "string"
}
```

**Par谩metros:**
- `location` (string, requerido): Direcci贸n textual
- `lat` (number, requerido): Latitud
- `lng` (number, requerido): Longitud
- `alias` (string, requerido): Alias de la direcci贸n
- `url` (string, opcional): URL de Google Maps
- `userId` (string, requerido): ID del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Direcci贸n creada exitosamente"
}
```

---

### 17. PUT /edit-direction

**Descripci贸n:** Actualiza una direcci贸n existente.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "locationID": "string",
  "location": "string",
  "lat": "number",
  "lng": "number",
  "alias": "string",
  "url": "string"
}
```

**Par谩metros:**
- `locationID` (string, requerido): ID de la direcci贸n a editar
- `location` (string, opcional): Nueva direcci贸n
- `lat` (number, opcional): Nueva latitud
- `lng` (number, opcional): Nueva longitud
- `alias` (string, opcional): Nuevo alias
- `url` (string, opcional): Nueva URL

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Direcci贸n actualizada exitosamente"
}
```

---

### 18. DELETE /delete-direction

**Descripci贸n:** Elimina una direcci贸n.

**Par谩metros de Query:**
- `id` (string): ID de la direcci贸n

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Direcci贸n eliminada exitosamente"
}
```

---

### 19. GET /user-directions

**Descripci贸n:** Obtiene todas las direcciones de un usuario.

**Par谩metros de Query:**
- `userid` (string): ID del usuario

**Respuesta Exitosa:**
```json
{
  "locationData": [
    {
      "id": "string",
      "alias": "string",
      "direction": "string",
      "lat": "number",
      "lng": "number"
    }
  ],
  "generic": {
    "codeError": "COD200",
    "msgError": "Datos encontrados"
  }
}
```

---

## Ь Gesti贸n de Facturaci贸n

### 20. POST /add-factura

**Descripci贸n:** Crea una nueva facturaci贸n para un usuario.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "userID": "string",
  "razonSocial": "string",
  "nit": "string"
}
```

**Par谩metros:**
- `userID` (string, requerido): ID o email del usuario
- `razonSocial` (string, requerido): Raz贸n social de la empresa
- `nit` (string, requerido): N煤mero de identificaci贸n tributaria

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Datos almacenados correctamente"
}
```

**Respuestas de Error:**
```json
{
  "codeError": "COD525",
  "msgError": "Usuario no valido"
}
```

```json
{
  "codeError": "COD526",
  "msgError": "Nit no v谩lido"
}
```

---

### 21. PUT /edit-factura

**Descripci贸n:** Actualiza los datos de facturaci贸n.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "id": "string",
  "razonSocial": "string",
  "nit": "string"
}
```

**Par谩metros:**
- `id` (string, requerido): ID de la facturaci贸n a editar
- `razonSocial` (string, opcional): Nueva raz贸n social
- `nit` (string, opcional): Nuevo NIT

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Datos almacenados correctamente"
}
```

---

### 22. DELETE /delete-factura

**Descripci贸n:** Elimina una facturaci贸n.

**Par谩metros de Query:**
- `id` (string): ID de la facturaci贸n

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Datos facturacion eliminados correctamente"
}
```

---

### 23. GET /facturaciones-user

**Descripci贸n:** Obtiene todas las facturaciones de un usuario.

**Par谩metros de Query:**
- `userid` (string): ID o email del usuario

**Respuesta Exitosa:**
```json
{
  "facturaciones": [
    {
      "id": "string",
      "userID": "string",
      "razonSocial": "string",
      "nit": "string"
    }
  ],
  "generic": {
    "codeError": "COD200",
    "msgError": "Datos encontrados"
  }
}
```

**Respuesta Sin Datos:**
```json
{
  "facturaciones": null,
  "generic": {
    "codeError": "COD565",
    "msgError": "No se encontraron datos"
  }
}
```

---

##  Autenticaci贸n Social

### 24. POST /google-login

**Descripci贸n:** Valida un token de Google (solo validaci贸n).

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "token": "string"
}
```

**Par谩metros:**
- `token` (string, requerido): Token de Google

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "usuario@gmail.com"
}
```

**Respuesta de Error:**
```json
{
  "codeError": "COD500",
  "msgError": "Credenciales de google no validas"
}
```

---

### 25. POST /google-operation

**Descripci贸n:** Crea usuario si no existe con token de Google.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "token": "string"
}
```

**Par谩metros:**
- `token` (string, requerido): Token de Google

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario creado exitosamente"
}
```

**Respuesta Usuario Existente:**
```json
{
  "codeError": "COD353",
  "msgError": "Cuenta existente"
}
```

---

### 26. POST /facebook-login

**Descripci贸n:** Valida un token de Facebook (solo validaci贸n).

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "token": "string"
}
```

**Par谩metros:**
- `token` (string, requerido): Token de Facebook

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "usuario@facebook.com"
}
```

---

### 27. POST /facebook-operation

**Descripci贸n:** Crea usuario si no existe con token de Facebook.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "token": "string"
}
```

**Par谩metros:**
- `token` (string, requerido): Token de Facebook

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Usuario creado exitosamente"
}
```

---

## 锔 Funcionalidades Adicionales

### 28. POST /add-expo-token

**Descripci贸n:** Agrega un token de Expo para notificaciones push.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "userID": "string",
  "token": "string"
}
```

**Par谩metros:**
- `userID` (string, requerido): ID del usuario
- `token` (string, requerido): Token de Expo

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Token agregado exitosamente"
}
```

---

### 29. POST /img

**Descripci贸n:** Sube una imagen para un usuario.

**Headers:**
```
Content-Type: multipart/form-data
```

**Request Body:**
- `id` (string): ID del usuario
- `img` (file): Archivo de imagen

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Imagen subida exitosamente"
}
```

---

### 30. PUT /user-last-location

**Descripci贸n:** Actualiza la 煤ltima ubicaci贸n conocida del usuario.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "userID": "string",
  "lat": "number",
  "lng": "number"
}
```

**Par谩metros:**
- `userID` (string, requerido): ID del usuario
- `lat` (number, requerido): Latitud
- `lng` (number, requerido): Longitud

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Ubicaci贸n actualizada exitosamente"
}
```

---

##  C贸digos de Error

| C贸digo | Descripci贸n |
|--------|-------------|
| COD200 | Operaci贸n exitosa |
| COD325 | Datos incorrectos |
| COD353 | Cuenta existente |
| COD404 | No encontrado |
| COD500 | Error interno del servidor |
| COD525 | Usuario/ID no v谩lido |
| COD526 | NIT no v谩lido (ya existe) |
| COD565 | No se encontraron datos |

---

##  Informaci贸n T茅cnica

### **Stack Tecnol贸gico**
- **Framework:** Spring Boot
- **Base de Datos:** MongoDB
- **Lenguaje:** Java 17+
- **ORM:** Spring Data MongoDB
- **Documentaci贸n:** Swagger/OpenAPI
- **Build Tool:** Maven

### **Arquitectura**
- **Patr贸n:** Microservicio
- **API:** REST
- **Validaci贸n:** Jakarta Validation
- **Respuestas:** GenericBean estandarizado

### **Configuraci贸n**
- **Puerto:** 3002
- **Context Path:** /santiago-users
- **Swagger UI:** /swagger-ui.html
- **Base de Datos:** MongoDB (puerto por defecto)

---

##  Ejemplos de Uso

### **Crear un usuario:**
```bash
curl -X POST http://localhost:3002/santiago-users/add-user \
  -H "Content-Type: application/json" \
  -d '{
    "names": "Juan",
    "lastNames": "P茅rez",
    "phoneNumber": "123456789",
    "email": "juan@example.com",
    "password": "password123"
  }'
```

### **Login de usuario:**
```bash
curl -X POST http://localhost:3002/santiago-users/login \
  -H "Content-Type: application/json" \
  -d '{
    "id": "juan@example.com",
    "password": "password123"
  }'
```

### **Crear una direcci贸n:**
```bash
curl -X POST http://localhost:3002/santiago-users/add-new-direction \
  -H "Content-Type: application/json" \
  -d '{
    "location": "Calle 123, Zona Centro",
    "lat": -17.389782,
    "lng": -66.1428,
    "alias": "Casa",
    "userId": "USER_ID_AQUI"
  }'
```

### **Crear facturaci贸n:**
```bash
curl -X POST http://localhost:3002/santiago-users/add-factura \
  -H "Content-Type: application/json" \
  -d '{
    "userID": "juan@example.com",
    "razonSocial": "Empresa ABC S.A.S",
    "nit": "900123456-7"
  }'
```

---

##  Notas Importantes

1. **Validaci贸n:** Todos los endpoints validan la existencia de usuarios antes de operar
2. **Paginaci贸n:** Los endpoints de listado soportan paginaci贸n con par谩metros `size` y `pageNo`
3. **Tokens:** Los endpoints de autenticaci贸n social requieren tokens v谩lidos
4. **Im谩genes:** El endpoint de subir imagen acepta archivos multipart/form-data
5. **Facturaci贸n:** Acepta tanto usuarios online como offline
6. **Direcciones:** Incluyen coordenadas GPS para geolocalizaci贸n
7. **Respuestas:** Todas siguen el patr贸n `GenericBean` para consistencia

---

##  Enlaces tiles

- **Swagger UI:** http://localhost:3002/swagger-ui.html
- **API Base:** http://localhost:3002/santiago-users
- **Documentaci贸n JSON:** http://localhost:3002/v3/api-docs
