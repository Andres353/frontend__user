# üöÄ API Completa - Santiago Pedidos MS

## üìã Informaci√≥n General

**Microservicio:** Santiago Pedidos MS  
**Versi√≥n:** 1.0.0  
**URL Base:** `http://localhost:4000/pedidos-ms`  
**Swagger UI:** `http://localhost:4000/swagger-ui.html`  
**Puerto:** 4000  
**Base de Datos:** MongoDB  

---

## üîó √çndice de Endpoints

### üì¶ **Gesti√≥n de Pedidos**
- [GET /get-order](#1-get-get-order) - Obtener lista de pedidos (paginado)
- [GET /get-order-user](#2-get-get-order-user) - Obtener pedidos de usuario offline
- [GET /get-order-user-online](#3-get-get-order-user-online) - Obtener pedidos de usuario online
- [GET /get-order-delivery](#4-get-get-order-delivery) - Obtener pedidos de delivery
- [GET /get-order-delivery-date](#5-get-get-order-delivery-date) - Obtener pedidos de delivery por fechas
- [GET /get-order-company](#6-get-get-order-company) - Obtener pedidos de empresa
- [GET /get-order-by](#7-get-get-order-by) - Obtener pedidos por usuario (paginado)
- [GET /get-order-branch](#8-get-get-order-branch) - Obtener pedidos de sucursal
- [GET /get-order-branch-date](#9-get-get-order-branch-date) - Obtener pedidos de sucursal por fechas

### ‚ûï **Creaci√≥n de Pedidos**
- [POST /order-add](#10-post-order-add) - Crear nuevo pedido
- [POST /order-add-package](#11-post-order-add-package) - Crear pedido tipo paquete
- [POST /order-add-offline](#12-post-order-add-offline) - Crear pedido offline
- [POST /order-add-branch](#13-post-order-add-branch) - Crear pedido desde sucursal

### üîÑ **Actualizaci√≥n de Pedidos**
- [PUT /order-update](#14-put-order-update) - Actualizar estado de pedido
- [PUT /change-visibility/{id}](#15-put-change-visibilityid) - Cambiar visibilidad de pedido
- [POST /add-delivery-manually](#16-post-add-delivery-manually) - Asignar delivery manualmente

### üÜò **Sistema SOS**
- [GET /send-user-noti](#17-get-send-user-noti) - Enviar notificaci√≥n SOS a usuario
- [GET /send-delivery-noti](#18-get-send-delivery-noti) - Enviar notificaci√≥n SOS a delivery
- [GET /get-sos-list](#19-get-get-sos-list) - Obtener lista de pedidos SOS
- [POST /sos](#20-post-sos) - Crear alerta SOS

### üìä **Dashboard y Estad√≠sticas**
- [GET /dashboard/stats/{entCode}](#21-get-dashboardstatsentcode) - Estad√≠sticas del dashboard
- [GET /dashboard/hourly-stats/{entCode}](#22-get-dashboardhourly-statsentcode) - Estad√≠sticas por hora

### üì∏ **Gesti√≥n de Im√°genes**
- [POST /upload-img](#23-post-upload-img) - Subir imagen de pedido
- [GET /images/get/{id}](#24-get-imagesgetid) - Obtener imagen por ID

### ‚≠ê **Rese√±as**
- [GET /delivery-reviews](#25-get-delivery-reviews) - Obtener rese√±as de delivery

---

## üì¶ Gesti√≥n de Pedidos

### 1. GET /get-order

**Descripci√≥n:** Obtiene una lista paginada de todos los pedidos.

**Par√°metros de Query:**
- `page` (int, requerido): N√∫mero de p√°gina (default: 0)
- `size` (int, requerido): Tama√±o de la p√°gina (default: 0)

**Respuesta Exitosa:**
```json
{
  "ordersData": [
    {
      "id": "string",
      "clientName": "string",
      "clientCode": "string",
      "deliveryCode": "string",
      "deliveryName": "string",
      "creationDate": "string",
      "urlEmpresa": "string",
      "total": 0,
      "status": 0,
      "orderCode": "string",
      "entName": "string",
      "cel": "string",
      "tel": "string",
      "auxCel": "string",
      "sizePaquete": "string",
      "nit": "string",
      "razonSocial": "string",
      "location": {
        "locationEnt": "string",
        "latEnt": 0,
        "lngEnt": 0,
        "locationUser": "string",
        "latUser": 0,
        "lngUser": 0,
        "initialLocationLat": 0,
        "initialLocationLng": 0,
        "initialLocation": "string",
        "alias": "string"
      },
      "comments": "string",
      "visibility": true,
      "products": [
        {
          "itemCode": "string",
          "quantity": 0,
          "nombre": "string",
          "price": 0,
          "total": 0,
          "pvs": [
            {
              "name": "string",
              "pricing": [
                {
                  "name": "string",
                  "price": 0
                }
              ]
            }
          ]
        }
      ],
      "type": "string",
      "entImg": "string",
      "imgPedido": "string",
      "chatData": {
        "udChat": "string",
        "readDoChatData": true,
        "readUoChatData": true,
        "uochat": "string",
        "dochat": "string"
      },
      "lastUpdate": "string",
      "waitingTime": "string",
      "inRestaurant": true,
      "paymentMethod": "string",
      "motivo": "string",
      "orderLit": "string",
      "celular": "string",
      "telefono": "string",
      "comision": 0,
      "fee": 0,
      "by": "string",
      "urlImg": "string",
      "dateIMG": "string",
      "urlPedido": ["string"],
      "sosData": {
        "deliveryCode": "string",
        "orderid": "string",
        "name": "string",
        "msg": "string",
        "lat": 0,
        "lng": 0
      },
      "kilometersData": {
        "distance": 0,
        "price": 0,
        "tiempoLimite": 0,
        "generic": {
          "codeError": "string",
          "msgError": "string"
        }
      }
    }
  ],
  "comisionTotal": 0,
  "totalPages": 0,
  "pageNumber": 0,
  "entereza": {
    "codeError": "string",
    "msgError": "string"
  }
}
```

---

### 2. GET /get-order-user

**Descripci√≥n:** Obtiene todos los pedidos de un usuario offline.

**Par√°metros de Query:**
- `userID` (string, requerido): ID del usuario offline

**Respuesta:** Misma estructura que `/get-order`

---

### 3. GET /get-order-user-online

**Descripci√≥n:** Obtiene todos los pedidos de un usuario online.

**Par√°metros de Query:**
- `userID` (string, requerido): ID del usuario online

**Respuesta:** Misma estructura que `/get-order`

---

### 4. GET /get-order-delivery

**Descripci√≥n:** Obtiene todos los pedidos asignados a un delivery.

**Par√°metros de Query:**
- `deliveryCode` (string, requerido): C√≥digo del delivery

**Respuesta:** Misma estructura que `/get-order`

---

### 5. GET /get-order-delivery-date

**Descripci√≥n:** Obtiene pedidos de un delivery en un rango de fechas.

**Par√°metros de Query:**
- `deliveryCode` (string, requerido): C√≥digo del delivery
- `fechaInicial` (string, requerido): Fecha inicial (formato: YYYY-MM-DD)
- `fechaFinal` (string, requerido): Fecha final (formato: YYYY-MM-DD)

**Respuesta:** Misma estructura que `/get-order`

---

### 6. GET /get-order-company

**Descripci√≥n:** Obtiene todos los pedidos de una empresa.

**Par√°metros de Query:**
- `branchCode` (string, requerido): C√≥digo de la sucursal/empresa

**Respuesta:** Misma estructura que `/get-order`

---

### 7. GET /get-order-by

**Descripci√≥n:** Obtiene pedidos filtrados por usuario con paginaci√≥n.

**Par√°metros de Query:**
- `user` (string, requerido): Usuario a filtrar
- `page` (int, requerido): N√∫mero de p√°gina (default: 0)
- `size` (int, requerido): Tama√±o de la p√°gina (default: 0)

**Respuesta:** Misma estructura que `/get-order`

---

### 8. GET /get-order-branch

**Descripci√≥n:** Obtiene todos los pedidos de una sucursal espec√≠fica.

**Par√°metros de Query:**
- `branchCode` (string, requerido): C√≥digo de la sucursal

**Respuesta:** Misma estructura que `/get-order`

---

### 9. GET /get-order-branch-date

**Descripci√≥n:** Obtiene pedidos de una sucursal en un rango de fechas.

**Par√°metros de Query:**
- `branchCode` (string, requerido): C√≥digo de la sucursal
- `fechaInicial` (string, requerido): Fecha inicial (formato: YYYY-MM-DD)
- `fechaFinal` (string, requerido): Fecha final (formato: YYYY-MM-DD)

**Respuesta:** Misma estructura que `/get-order`

---

## ‚ûï Creaci√≥n de Pedidos

### 10. POST /order-add

**Descripci√≥n:** Crea un nuevo pedido est√°ndar.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "clientCode": "string",
  "locationId": "string",
  "total": 0,
  "nit": "string",
  "phone": 0,
  "entcode": "string",
  "comments": "string",
  "paymentMethod": "string",
  "type": "string",
  "inRestaurant": true,
  "initialLocation": "string",
  "products": [
    {
      "itemCode": "string",
      "quantity": 0,
      "nombre": "string",
      "price": 0,
      "total": 0,
      "pvs": [
        {
          "name": "string",
          "pricing": [
            {
              "name": "string",
              "price": 0
            }
          ]
        }
      ]
    }
  ]
}
```

**Par√°metros:**
- `clientCode` (string, requerido): C√≥digo del cliente
- `locationId` (string, requerido): ID de la ubicaci√≥n/sucursal
- `total` (number, requerido): Total del pedido
- `nit` (string, requerido): NIT del cliente
- `phone` (number, requerido): Tel√©fono del cliente
- `entcode` (string, requerido): C√≥digo de la empresa
- `comments` (string, opcional): Comentarios del pedido
- `paymentMethod` (string, requerido): M√©todo de pago
- `type` (string, requerido): Tipo de pedido (delivery/pickup)
- `inRestaurant` (boolean, requerido): Si es en restaurante
- `initialLocation` (string, requerido): Ubicaci√≥n inicial
- `products` (array, requerido): Lista de productos

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Pedido creado exitosamente"
}
```

**Respuesta de Error:**
```json
{
  "codeError": "COD868",
  "msgError": "Sucursal no valida"
}
```

---

### 11. POST /order-add-package

**Descripci√≥n:** Crea un pedido tipo paquete/env√≠o.

**Headers:**
```
Content-Type: multipart/form-data
```

**Par√°metros de Query:**
- `clientCode` (string, requerido): C√≥digo del cliente
- `comments` (string, requerido): Comentarios
- `paymentMethod` (string, requerido): M√©todo de pago
- `initialLocation` (string, requerido): Ubicaci√≥n inicial
- `initialLat` (number, requerido): Latitud inicial
- `initialLng` (number, requerido): Longitud inicial
- `finalLat` (number, requerido): Latitud final
- `finalLng` (number, requerido): Longitud final
- `finalLocation` (string, requerido): Ubicaci√≥n final
- `auxCel` (string, opcional): Celular auxiliar
- `price` (number, requerido): Precio del env√≠o
- `sizePaquete` (string, requerido): Tama√±o del paquete

**Request Body:**
- `imgAux` (array): Im√°genes auxiliares del paquete

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Pedido de paquete creado exitosamente"
}
```

---

### 12. POST /order-add-offline

**Descripci√≥n:** Crea un pedido offline (sin usuario registrado).

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "clientCode": "string",
  "locationID": "string",
  "nit": "string",
  "razonSocial": "string",
  "total": 0,
  "entcode": "string",
  "comments": "string",
  "paymentMethod": "string",
  "deliveryCode": "string",
  "orderLit": "string",
  "by": "string",
  "commission": 0,
  "products": [
    {
      "itemCode": "string",
      "quantity": 0,
      "nombre": "string",
      "price": 0,
      "total": 0,
      "pvs": [
        {
          "name": "string",
          "pricing": [
            {
              "name": "string",
              "price": 0
            }
          ]
        }
      ]
    }
  ],
  "price": 0,
  "initialLocation": "string",
  "finalLocation": "string"
}
```

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Pedido offline creado exitosamente"
}
```

---

### 13. POST /order-add-branch

**Descripci√≥n:** Crea un pedido desde una sucursal espec√≠fica.

**Headers:**
```
Content-Type: multipart/form-data
```

**Par√°metros de Query:**
- `clientCode` (string, requerido): C√≥digo del cliente
- `comments` (string, requerido): Comentarios
- `paymentMethod` (string, requerido): M√©todo de pago
- `initialLocation` (string, requerido): Ubicaci√≥n inicial
- `initialLat` (number, requerido): Latitud inicial
- `initialLng` (number, requerido): Longitud inicial
- `finalLat` (number, requerido): Latitud final
- `finalLng` (number, requerido): Longitud final
- `finalLocation` (string, requerido): Ubicaci√≥n final
- `auxCel` (string, opcional): Celular auxiliar
- `price` (number, requerido): Precio
- `sizePaquete` (string, requerido): Tama√±o del paquete
- `products` (string, requerido): Productos en formato JSON

**Request Body:**
- `imgAux` (array): Im√°genes auxiliares

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Pedido de sucursal creado exitosamente"
}
```

---

## üîÑ Actualizaci√≥n de Pedidos

### 14. PUT /order-update

**Descripci√≥n:** Actualiza el estado de un pedido.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "orderCode": "string",
  "status": 0,
  "motivo": "string"
}
```

**Par√°metros:**
- `orderCode` (string, requerido): C√≥digo del pedido
- `status` (number, requerido): Nuevo estado del pedido
- `motivo` (string, opcional): Motivo del cambio de estado

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Pedido actualizado exitosamente"
}
```

---

### 15. PUT /change-visibility/{id}

**Descripci√≥n:** Cambia la visibilidad de un pedido.

**Par√°metros de Path:**
- `id` (string): ID del pedido

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Visibilidad cambiada exitosamente"
}
```

---

### 16. POST /add-delivery-manually

**Descripci√≥n:** Asigna un delivery a un pedido manualmente.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "orderCode": "string",
  "deliveryCode": "string"
}
```

**Par√°metros:**
- `orderCode` (string, requerido): C√≥digo del pedido
- `deliveryCode` (string, requerido): C√≥digo del delivery

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Delivery asignado exitosamente"
}
```

---

## üÜò Sistema SOS

### 17. GET /send-user-noti

**Descripci√≥n:** Env√≠a notificaci√≥n SOS a un usuario.

**Par√°metros de Query:**
- `id` (string, requerido): ID del usuario

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Notificaci√≥n SOS enviada"
}
```

---

### 18. GET /send-delivery-noti

**Descripci√≥n:** Env√≠a notificaci√≥n SOS a un delivery.

**Par√°metros de Query:**
- `idDelivery` (string, requerido): ID del delivery

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Notificaci√≥n SOS enviada al delivery"
}
```

---

### 19. GET /get-sos-list

**Descripci√≥n:** Obtiene la lista de pedidos con alertas SOS activas.

**Respuesta Exitosa:**
```json
{
  "dataBean": [
    {
      "deliveryCode": "string",
      "orderID": "string",
      "name": "string",
      "msg": "string"
    }
  ],
  "generic": {
    "codeError": "COD200",
    "msgError": "Lista SOS obtenida"
  }
}
```

---

### 20. POST /sos

**Descripci√≥n:** Crea una alerta SOS para un pedido.

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "deliveryCode": "string",
  "orderid": "string",
  "name": "string",
  "msg": "string",
  "lat": 0,
  "lng": 0
}
```

**Par√°metros:**
- `deliveryCode` (string, requerido): C√≥digo del delivery
- `orderid` (string, requerido): ID del pedido
- `name` (string, requerido): Nombre de quien env√≠a el SOS
- `msg` (string, requerido): Mensaje del SOS
- `lat` (number, requerido): Latitud actual
- `lng` (number, requerido): Longitud actual

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "SOS creado exitosamente"
}
```

---

## üìä Dashboard y Estad√≠sticas

### 21. GET /dashboard/stats/{entCode}

**Descripci√≥n:** Obtiene estad√≠sticas completas del dashboard para una empresa.

**Par√°metros de Path:**
- `entCode` (string): C√≥digo de la empresa

**Par√°metros de Query:**
- `startDate` (string, requerido): Fecha de inicio (formato: YYYY-MM-DD)
- `endDate` (string, requerido): Fecha de fin (formato: YYYY-MM-DD)

**Respuesta Exitosa:**
```json
{
  "totalOrders": 0,
  "totalRevenue": 0,
  "avgOrderValue": 0,
  "completedOrders": 0,
  "canceledOrders": 0,
  "completionRate": 0,
  "statusDistribution": [
    {
      "status": 0,
      "statusName": "string",
      "count": 0,
      "percentage": 0
    }
  ],
  "topProducts": [
    {
      "productName": "string",
      "productCode": "string",
      "quantitySold": 0,
      "revenue": 0
    }
  ],
  "dailyRevenue": [
    {
      "date": "string",
      "revenue": 0,
      "orderCount": 0
    }
  ],
  "paymentMethods": [
    {
      "paymentMethod": "string",
      "count": 0,
      "percentage": 0,
      "totalAmount": 0
    }
  ],
  "hourlyDistribution": {
    "additionalProp1": 0,
    "additionalProp2": 0,
    "additionalProp3": 0
  },
  "branchName": "string",
  "dateRange": "string"
}
```

---

### 22. GET /dashboard/hourly-stats/{entCode}

**Descripci√≥n:** Obtiene estad√≠sticas por hora para una empresa.

**Par√°metros de Path:**
- `entCode` (string): C√≥digo de la empresa

**Par√°metros de Query:**
- `startDate` (string, requerido): Fecha de inicio
- `endDate` (string, requerido): Fecha de fin

**Respuesta Exitosa:**
```json
{}
```

---

## üì∏ Gesti√≥n de Im√°genes

### 23. POST /upload-img

**Descripci√≥n:** Sube una imagen asociada a un pedido.

**Headers:**
```
Content-Type: multipart/form-data
```

**Request Body:**
- `id` (string, requerido): ID del pedido
- `img` (file, requerido): Archivo de imagen

**Respuesta Exitosa:**
```json
{
  "codeError": "COD200",
  "msgError": "Imagen subida exitosamente"
}
```

---

### 24. GET /images/get/{id}

**Descripci√≥n:** Obtiene una imagen por su ID.

**Par√°metros de Path:**
- `id` (string): ID de la imagen

**Respuesta Exitosa:**
```
Content-Type: image/png
[Binary image data]
```

---

## ‚≠ê Rese√±as

### 25. GET /delivery-reviews

**Descripci√≥n:** Obtiene las rese√±as de un delivery espec√≠fico.

**Par√°metros de Query:**
- `deliveryCode` (string, requerido): C√≥digo del delivery

**Respuesta Exitosa:**
```json
{
  "message": "string",
  "success": true,
  "reviews": [
    {
      "id": "string",
      "orderId": "string",
      "clientName": "string",
      "stars": 0,
      "comments": "string",
      "creationDate": "string",
      "reviewType": "string"
    }
  ],
  "averageStars": 0,
  "totalReviews": 0,
  "deliveryCode": "string",
  "deliveryName": "string"
}
```

---

## üìä C√≥digos de Error

| C√≥digo | Descripci√≥n |
|--------|-------------|
| COD200 | Operaci√≥n exitosa |
| COD868 | Sucursal no v√°lida |
| COD500 | Error interno del servidor |
| COD404 | No encontrado |
| COD400 | Solicitud incorrecta |

---

## üîß Informaci√≥n T√©cnica

### **Stack Tecnol√≥gico**
- **Framework:** Spring Boot
- **Base de Datos:** MongoDB
- **Lenguaje:** Java 17+
- **ORM:** Spring Data MongoDB
- **Documentaci√≥n:** Swagger/OpenAPI
- **Build Tool:** Maven

### **Arquitectura**
- **Patr√≥n:** Microservicio
- **API:** REST
- **Validaci√≥n:** Jakarta Validation
- **Respuestas:** GenericBean estandarizado

### **Configuraci√≥n**
- **Puerto:** 4000
- **Context Path:** /pedidos-ms
- **Swagger UI:** /swagger-ui.html
- **Base de Datos:** MongoDB

---

## üöÄ Ejemplos de Uso

### **Crear un pedido:**
```bash
curl -X POST http://localhost:4000/pedidos-ms/order-add \
  -H "Content-Type: application/json" \
  -d '{
    "clientCode": "CLI001",
    "locationId": "b7d31acb-2dea-4e3c-b3e9-0bf7362f1375",
    "total": 45.75,
    "nit": "123456789",
    "phone": 12345678,
    "entcode": "ENT001",
    "comments": "Sin cebolla",
    "paymentMethod": "efectivo",
    "type": "delivery",
    "inRestaurant": false,
    "initialLocation": "La Paz Centro",
    "products": [
      {
        "itemCode": "PROD001",
        "quantity": 2,
        "nombre": "Pizza Margherita",
        "price": 22.875,
        "total": 45.75,
        "pvs": [
          {
            "name": "Tama√±o",
            "pricing": [
              {
                "name": "Grande",
                "price": 22.875
              }
            ]
          }
        ]
      }
    ]
  }'
```

### **Obtener pedidos de un usuario:**
```bash
curl -X GET "http://localhost:4000/pedidos-ms/get-order-user?userID=USER123"
```

### **Actualizar estado de pedido:**
```bash
curl -X PUT http://localhost:4000/pedidos-ms/order-update \
  -H "Content-Type: application/json" \
  -d '{
    "orderCode": "ORD123",
    "status": 2,
    "motivo": "En camino"
  }'
```

### **Crear alerta SOS:**
```bash
curl -X POST http://localhost:4000/pedidos-ms/sos \
  -H "Content-Type: application/json" \
  -d '{
    "deliveryCode": "DEL001",
    "orderid": "ORD123",
    "name": "Juan P√©rez",
    "msg": "Problema con el pedido",
    "lat": -17.389782,
    "lng": -66.1428
  }'
```

---

## üìù Notas Importantes

1. **Validaci√≥n de Sucursales:** El `locationId` debe existir en la base de datos
2. **Estados de Pedido:** Los estados son num√©ricos (0=Pendiente, 1=Confirmado, 2=En camino, etc.)
3. **Paginaci√≥n:** Los endpoints de listado soportan paginaci√≥n con `page` y `size`
4. **Fechas:** Formato requerido: YYYY-MM-DD
5. **Im√°genes:** Se aceptan archivos multipart/form-data
6. **SOS:** Sistema de alertas de emergencia para deliveries
7. **Dashboard:** Estad√≠sticas en tiempo real para empresas
8. **Rese√±as:** Sistema de calificaci√≥n para deliveries

---

## üîó Enlaces √ötiles

- **Swagger UI:** http://localhost:4000/swagger-ui.html
- **API Base:** http://localhost:4000/pedidos-ms
- **Documentaci√≥n JSON:** http://localhost:4000/api-docs
