# üìö API Completa - Business Dashboard Backend

## üöÄ Informaci√≥n General

- **Base URL**: `http://localhost:3001/api`
- **Documentaci√≥n Swagger**: `http://localhost:3001/api-docs`
- **Versi√≥n**: 1.0.0
- **Autenticaci√≥n**: JWT Bearer Token (excepto login/register)

---

## üîê **AUTHENTICATION ENDPOINTS**

### **POST /api/auth/register**
Registrar una nueva empresa

**Request Body:**
```json
{
  "name": "Nombre de la empresa",
  "email": "email@empresa.com",
  "password": "contrase√±a123",
  "categoryName": "Restaurante",
  "categoryCode": "c√≥digo_categor√≠a",
  "companyPrice": "normal"
}
```

**Response:**
```json
{
  "message": "Company registered successfully",
  "token": "jwt_token_here",
  "company": {
    "id": "company_id",
    "name": "Nombre de la empresa",
    "email": "email@empresa.com",
    "categoryName": "Restaurante",
    "status": "ACTIVE"
  }
}
```

### **POST /api/auth/login**
Iniciar sesi√≥n

**Request Body:**
```json
{
  "email": "agcastel75@gmail.com",
  "password": "123456"
}
```

**Response:**
```json
{
  "message": "Login successful",
  "token": "jwt_token_here",
  "company": {
    "id": "company_id",
    "name": "Andres Gabriel Castel",
    "email": "agcastel75@gmail.com",
    "categoryName": "Restaurante",
    "status": "ACTIVE",
    "image": "logo_url",
    "imageP": "logo_secundario_url"
  }
}
```

### **GET /api/auth/profile**
Obtener perfil de la empresa (Requiere autenticaci√≥n)

**Headers:**
```
Authorization: Bearer jwt_token_here
```

**Response:**
```json
{
  "id": "company_id",
  "name": "Andres Gabriel Castel",
  "email": "agcastel75@gmail.com",
  "categoryName": "Restaurante",
  "status": "ACTIVE",
  "image": "logo_url",
  "imageP": "logo_secundario_url",
  "companyPrice": "normal",
  "commission": "20"
}
```

### **PUT /api/auth/profile**
Actualizar perfil de la empresa (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "name": "Nuevo nombre",
  "email": "nuevo@email.com",
  "categoryName": "Nueva categor√≠a"
}
```

### **PUT /api/auth/change-password**
Cambiar contrase√±a (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "currentPassword": "contrase√±a_actual",
  "newPassword": "nueva_contrase√±a"
}
```

---

## üè¢ **BRANCHES ENDPOINTS**

### **GET /api/branches**
Obtener todas las sucursales de la empresa (Requiere autenticaci√≥n)

**Query Parameters:**
- `page` (opcional): N√∫mero de p√°gina (default: 1)
- `limit` (opcional): Elementos por p√°gina (default: 20)
- `search` (opcional): B√∫squeda por nombre
- `status` (opcional): Filtrar por estado (true/false)

**Response:**
```json
{
  "branches": [
    {
      "id": "branch_id",
      "sectorName": "Sucursal Principal",
      "branCode": "b7d31acb-2dea-4e3c-b3e9-0bf7362f1375",
      "status": true,
      "wpp": "23525353",
      "lat": -17.38895034790039,
      "Long": -66.1562271118164,
      "company": {
        "id": "company_id",
        "name": "Andres Gabriel Castel",
        "image": "logo_url"
      }
    }
  ],
  "totalPages": 1,
  "currentPage": 1,
  "total": 1
}
```

### **GET /api/branches/:id**
Obtener sucursal espec√≠fica (Requiere autenticaci√≥n)

### **POST /api/branches**
Crear nueva sucursal (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "sectorName": "Nueva Sucursal",
  "branCode": "c√≥digo_√∫nico",
  "wpp": "12345678",
  "lat": -17.38895034790039,
  "Long": -66.1562271118164,
  "password": "contrase√±a_sucursal"
}
```

### **PUT /api/branches/:id**
Actualizar sucursal (Requiere autenticaci√≥n)

### **DELETE /api/branches/:id**
Eliminar sucursal (Requiere autenticaci√≥n)

---

## üçï **PRODUCTS ENDPOINTS**

### **GET /api/products**
Obtener todos los productos (Requiere autenticaci√≥n)

**Query Parameters:**
- `page` (opcional): N√∫mero de p√°gina
- `limit` (opcional): Elementos por p√°gina
- `search` (opcional): B√∫squeda por nombre
- `category` (opcional): Filtrar por categor√≠a
- `status` (opcional): Filtrar por estado

**Response:**
```json
{
  "products": [
    {
      "id": "product_id",
      "name": "Pizza Interminable",
      "description": "Pizza de 24 porciones",
      "pricing": 300,
      "status": 1,
      "visibleItem": true,
      "categoryProductId": "category_id",
      "variables": ["variable_id"]
    }
  ],
  "totalPages": 1,
  "currentPage": 1,
  "total": 4
}
```

### **GET /api/products/:id**
Obtener producto espec√≠fico (Requiere autenticaci√≥n)

### **POST /api/products**
Crear nuevo producto (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "name": "Nuevo Producto",
  "description": "Descripci√≥n del producto",
  "pricing": 50,
  "categoryProductId": "category_id",
  "status": 1,
  "visibleItem": true
}
```

### **PUT /api/products/:id**
Actualizar producto (Requiere autenticaci√≥n)

### **DELETE /api/products/:id**
Eliminar producto (Requiere autenticaci√≥n)

### **GET /api/products/categories**
Obtener categor√≠as para productos (Requiere autenticaci√≥n)

---

## üì¶ **ORDERS ENDPOINTS**

### **GET /api/orders**
Obtener todos los pedidos (Requiere autenticaci√≥n)

**Query Parameters:**
- `page` (opcional): N√∫mero de p√°gina
- `limit` (opcional): Elementos por p√°gina
- `status` (opcional): Filtrar por estado
- `search` (opcional): B√∫squeda
- `dateFrom` (opcional): Fecha desde
- `dateTo` (opcional): Fecha hasta

**Response:**
```json
{
  "orders": [
    {
      "id": "order_id",
      "orderNumber": "ORD-000001",
      "customerName": "Cliente Test",
      "customerPhone": "12345678",
      "total": 600,
      "status": "pending",
      "paymentMethod": "cash",
      "createdAt": "2023-11-29T18:47:53.000Z"
    }
  ],
  "totalPages": 1,
  "currentPage": 1,
  "total": 1,
  "stats": {
    "totalOrders": 1,
    "totalRevenue": 600,
    "avgOrderValue": 600
  }
}
```

### **GET /api/orders/:id**
Obtener pedido espec√≠fico (Requiere autenticaci√≥n)

### **POST /api/orders**
Crear nuevo pedido (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "customerName": "Cliente Test",
  "customerPhone": "12345678",
  "customerAddress": "Direcci√≥n de prueba",
  "customerEmail": "cliente@email.com",
  "items": [
    {
      "productId": "product_id",
      "quantity": 2,
      "variables": {}
    }
  ],
  "notes": "Comentarios",
  "paymentMethod": "cash",
  "deliveryFee": 0,
  "tax": 0
}
```

### **PATCH /api/orders/:id/status**
Actualizar estado del pedido (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "status": "confirmed",
  "driverId": "driver_id"
}
```

**Estados v√°lidos:**
- `pending`, `confirmed`, `preparing`, `ready`, `out_for_delivery`, `delivered`, `cancelled`

### **GET /api/orders/stats/overview**
Obtener estad√≠sticas de pedidos (Requiere autenticaci√≥n)

**Query Parameters:**
- `period` (opcional): `today`, `week`, `month`

---

## üöÄ **MICROSERVICE ENDPOINTS**

### **POST /api/orders/pedidos-ms/order-add**
Crear pedido v√≠a microservicio (NO requiere autenticaci√≥n)

**Request Body:**
```json
{
  "clientCode": "Cliente Test",
  "locationId": "b7d31acb-2dea-4e3c-b3e9-0bf7362f1375",
  "total": 600,
  "nit": "123456789",
  "phone": 12345678,
  "entcode": "ENT001",
  "comments": "Comentarios de prueba",
  "paymentMethod": "cash",
  "type": "delivery",
  "inRestaurant": false,
  "initialLocation": "Direcci√≥n de prueba",
  "products": [
    {
      "itemCode": "c2f515b6-2aab-400e-929b-1e02d1caa19a",
      "quantity": 2,
      "nombre": "Pizza Interminable",
      "price": 300,
      "total": 600,
      "pvs": [
        {
          "name": "Tama√±o",
          "pricing": [
            {
              "name": "Grande",
              "price": 10
            }
          ]
        }
      ]
    }
  ]
}
```

**Response:**
```json
{
  "codeError": "SUCCESS",
  "msgError": "Pedido creado exitosamente",
  "orderId": "order_id",
  "orderNumber": "ORD-000001"
}
```

**C√≥digos de error:**
- `VALIDATION_ERROR`: Error de validaci√≥n
- `BRANCH_NOT_FOUND`: Sucursal no encontrada
- `BRANCH_INACTIVE`: Sucursal inactiva
- `COMPANY_NOT_FOUND`: Empresa no encontrada
- `PRODUCT_NOT_FOUND`: Producto no encontrado
- `SERVER_ERROR`: Error interno del servidor

---

## üìÇ **CATEGORIES ENDPOINTS**

### **GET /api/categories**
Obtener todas las categor√≠as (Requiere autenticaci√≥n)

### **GET /api/categories/:id**
Obtener categor√≠a espec√≠fica (Requiere autenticaci√≥n)

### **POST /api/categories**
Crear nueva categor√≠a (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "categoryName": "Nueva Categor√≠a",
  "waitingTime": "30",
  "status": 1
}
```

### **PUT /api/categories/:id**
Actualizar categor√≠a (Requiere autenticaci√≥n)

### **DELETE /api/categories/:id**
Eliminar categor√≠a (Requiere autenticaci√≥n)

---

## üîß **PRODUCT VARIABLES ENDPOINTS**

### **GET /api/product-variables/product/:productId**
Obtener variables de un producto (Requiere autenticaci√≥n)

### **POST /api/product-variables/product/:productId**
Crear variable para un producto (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "name": "Tama√±o",
  "canMany": false,
  "required": true,
  "instructions": "Elige el tama√±o",
  "quantity": 1
}
```

### **POST /api/product-variables/:variableId/options**
Agregar opci√≥n de precio a una variable (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "name": "Grande",
  "price": 10
}
```

---

## üõµ **MOTO ENDPOINTS**

### **POST /api/moto**
Crear solicitud de moto (Requiere autenticaci√≥n)

**Request Body:**
```json
{
  "pickupAddress": {
    "address": "Direcci√≥n de recogida",
    "lat": -17.38895034790039,
    "lng": -66.1562271118164
  },
  "deliveryAddress": {
    "address": "Direcci√≥n de entrega",
    "lat": -17.38895034790039,
    "lng": -66.1562271118164
  },
  "requestNumber": "REQ-001",
  "description": "Descripci√≥n del env√≠o",
  "priority": "medium"
}
```

### **GET /api/moto**
Obtener todas las solicitudes de moto (Requiere autenticaci√≥n)

---

## üí∞ **PRICING ENDPOINTS**

### **GET /api/pricing**
Obtener precios (Requiere autenticaci√≥n)

### **POST /api/pricing**
Crear nuevo precio (Requiere autenticaci√≥n)

---

## üîë **CREDENCIALES DE PRUEBA**

### **Empresa:**
- **Email**: `agcastel75@gmail.com`
- **Contrase√±a**: `123456`
- **Nombre**: Andres Gabriel Castel

### **Sucursal:**
- **C√≥digo**: `b7d31acb-2dea-4e3c-b3e9-0bf7362f1375`
- **Nombre**: Sucursal Principal
- **Contrase√±a**: `123456`

### **Producto:**
- **C√≥digo**: `c2f515b6-2aab-400e-929b-1e02d1caa19a`
- **Nombre**: Pizza Interminable
- **Precio**: 300

---

## üö® **C√ìDIGOS DE ERROR COMUNES**

| C√≥digo | Descripci√≥n |
|--------|-------------|
| `VALIDATION_ERROR` | Error de validaci√≥n de datos |
| `BRANCH_NOT_FOUND` | Sucursal no encontrada |
| `BRANCH_INACTIVE` | Sucursal inactiva |
| `COMPANY_NOT_FOUND` | Empresa no encontrada |
| `PRODUCT_NOT_FOUND` | Producto no encontrado |
| `SERVER_ERROR` | Error interno del servidor |
| `UNAUTHORIZED` | No autorizado (token inv√°lido) |
| `FORBIDDEN` | Acceso denegado |

---

## üìù **NOTAS IMPORTANTES**

1. **Autenticaci√≥n**: La mayor√≠a de endpoints requieren el header `Authorization: Bearer token`
2. **Paginaci√≥n**: Los endpoints de listado soportan `page` y `limit`
3. **B√∫squeda**: Muchos endpoints soportan par√°metro `search`
4. **Filtros**: Usa `status`, `category`, `dateFrom`, `dateTo` seg√∫n el endpoint
5. **Swagger**: Accede a `http://localhost:3001/api-docs` para documentaci√≥n interactiva
6. **Microservicio**: El endpoint `/pedidos-ms/order-add` NO requiere autenticaci√≥n

---

## üõ†Ô∏è **COMANDOS √öTILES**

### **Iniciar servidor:**
```bash
npm start
```

### **Ejecutar seed data:**
```bash
node src/scripts/seedData.js
```

### **Probar endpoint de pedidos:**
```bash
node src/scripts/testOrderMicroservice.js
```

### **Verificar salud del backend:**
```bash
node src/scripts/checkBackendHealth.js
```

---

*Documentaci√≥n generada autom√°ticamente - Business Dashboard Backend v1.0.0*
